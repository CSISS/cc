<!DOCTYPE html>
<!-- 

    Author : Z.S. 
    Date : 2/3/2017

 -->
<!--suppress LossyEncoding -->
<html xmlns:th="http://www.thymeleaf.org"  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="frame" >
  
    <head>
  
        <title>CyberConnector Function Portal</title>
        
        <link rel="stylesheet" th:href="@{/css/leaflet.css}" />
        
        <script type="text/javascript" th:src="@{/js/leaflet.js}" ></script>
        
        <script type="text/javascript" th:src="@{/js/datetimepicker.js}" ></script>
        
        <script type="text/javascript" th:src="@{/js/cc.upload.js}" ></script>
        
        <script type="text/javascript" th:src="@{/js/cc.product.js}" ></script>
        
    </head>
  
    <body>
        
        <div class="clearfix" layout:fragment="content" >
        
            <div class="sec-heading font-default" >
        
                <div class="container" >
        
                    <h2 class="pull-left">Search Products</h2>
        
                    <div class="detail-text pull-right" >
                        This page is for users to search data product. If the product is virtual, a real data will be later generated by a geoprocessing workflow. If the product is real, the data will be available directly.
                    </div>
        
                </div>
        
            </div>
            
            <!-- ************************************************************* -->
            <!-- *************** Search Form ********************************* -->
            <!-- ************************************************************* -->
            
            <form class="form-horizontal" th:action="@{/search}"  method="get">
                
                <fieldset>
                    
                    <!-- left-->
                    
                    <div class="col-md-6">
                    
                        <div class="row">
                        
                            <label class="col-md-4 control-label" for="location">Search Text</label>  
                      
                              <div class="col-md-8">
                              
                                    <input type="text" th:field="${request.searchtext}" placeholder="type something.." class="form-control input-md" />
                              
                                    <br/>
                              
                                    <span class="button-checkbox"><button type="button" class="btn btn-primary active" data-color="primary">Name</button><input type="checkbox" class="hidden"  th:field="${request.name}" checked="checked" /></span>
                                
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-primary active" data-color="primary">Description</button>
                                        <input type="checkbox" class="hidden" th:field="${request.desc}" checked="checked" />
                                    </span>
                                
                                    <span class="button-checkbox">
                                        <button type="button" class="btn btn-primary active" data-color="primary">Keywords</button>
                                        <input type="checkbox" class="hidden"  th:field="${request.keywords}" checked="checked"  />
                                    </span>
                                    
                              </div>
                        
                        </div>
                        
                        <br/>
                    
                        <div class="row">
                        
                            <label class="col-md-4 control-label" for="isvirtual">If Virtual?</label>
                          
                              <div class="col-md-8">
                              
                                <select id="isvirtual" name="isvirtual" th:field="${request.isvirtual}" class="form-control">
                              
                                  <!-- <option value="2">Both</option> -->
                                  
                                  <option value="1">Virtual</option>
                              
                                  <option value="0">Real</option>
                              
                                </select>
                              
                              </div>
                        
                        </div>
                        
                        <br/>
                        
                        <div class="row">
                        
                            <label class="col-md-4 control-label" for="csw">Select CSW</label>
                          
                              <div class="col-md-8">
                              
                                <select id="csw" name="csw" th:field="${request.csw}" class="form-control" disabled="disabled">
                                    
                                  <option value="-1" disabled="disabled" selected="selected" style="display:none"> -- select an option --</option>
                                    
                                  <option value="1">CSISS Catalogue for Unidata Thredds Data Server</option>
                              
                                  <!-- <option value="0">CEOS WGISS Integrated Catalog (CWIC)</option> -->
                              
                                </select>
                              
                              </div>
                        
                        </div>
                        
                        <br/>
                          
                        <div class="row">
                        
                            <label class="col-md-4 control-label" for="selectbasic">Format</label>
                      
                              <div class="col-md-4">
                                    
                                    <ul class="list-unstyled" id="formatall">
                                          
                                          <li><label><input type="checkbox" class="all"  checked="checked" /> All</label></li>
                                    
                                    </ul>
                                    
                                    <ul class="list-unstyled" id="formatlist">
                                          
                                          <li><label><input type="checkbox" name="csv" /> CSV</label></li>
                                          
                                          <li><label><input type="checkbox" name="geojson" /> GeoJSON</label></li>
                                          
                                          <li><label><input type="checkbox" name="geotiff" /> GeoTiff</label></li>
                                          
                                          <li><label><input type="checkbox" name="hdf" /> HDF</label></li>
                                          
                                          <li><label><input type="checkbox" name="json" /> JSON</label></li>
                                          
                                          <li><label><input type="checkbox" name="kml" /> KML</label></li>
                                          
                                          <li><label><input type="checkbox" name="netcdf" /> netCDF</label></li>
                                          
                                          <li><label><input type="checkbox" name="shp" /> SHP</label></li>
                                          
                                          <li><label><input type="checkbox" name="tar" /> TAR</label></li>
                                          
                                          <li><label><input type="checkbox" name="tiff" /> TIFF</label></li>
                                          
                                          <li><label><input type="checkbox" name="zip" /> ZIP</label></li>
                                          
                                          <!-- 
                                          
                                          <li><label><input type="checkbox" name="html" /> HTML</label></li>
                                          
                                          <li><label><input type="checkbox" name="jpg" /> JPG</label></li>
                                          
                                          <li><label><input type="checkbox" name="pdf" /> PDF</label></li>
                                          
                                          <li><label><input type="checkbox" name="xml" /> XML</label></li>
                                          
                                          <li><label><input type="checkbox" name="xlsx" /> XLSX</label></li> 
                                          
                                          -->
                                          
                                    </ul>
                                
                              </div>
                              
                              <div class="col-md-4">
                                
                                    <button class="btn btn-xs btn-primary" value="btn-xs" type="button" id="moreorless">more</button>
                                    
                              </div>
                        
                        </div>
                        
                        <br/>
                          
                        <div class="row">
                        
                            <label class="col-md-4 control-label" for="price_min">Records/Page </label>
                          
                          <div class="col-md-8">
                          
                            <select id="price_min" name="price_min" th:field="${request.recordsperpage}" class="form-control">
                                    
                              <option value="5">5</option>
                          
                              <option value="10">10</option>
                                
                              <option value="50">50</option>
                          
                              <option value="100">100</option>
                          
                            </select>
                          
                          </div>
                        
                        </div>
                          
                    </div>
                    
                    <!-- right -->
                    
                    <div class="col-md-6">
                    
                        <div class="row">
                        
                            <div class="col-md-3 ">
                                <label class="control-label pull-right" for="property_type">Spatial Extent</label>
                            </div>
                            
                              <div class="col-md-8">
                                    <div id="mapid" ></div>
                                    <hr/>
                                    <input type="hidden" id="west" th:field="${request.west}" />
                                    <input type="hidden" id="east" th:field="${request.east}" />
                                    <input type="hidden" id="south" th:field="${request.south}" />
                                    <input type="hidden" id="north" th:field="${request.north}" />
                                
                              </div>
                        
                        </div>
                    
                         <div class="row">
                         
                            <div class="col-md-3">
                            
                                <label class=" control-label pull-right" for="price_min">Time Extent <br/>
                                
                                   <span>
                                   
                                    <input type="checkbox" name="distime" th:field="${request.distime}" id="distime" value="false" /> disable
                                   
                                   </span>
                                
                                </label>
                            
                            </div>
                            
                              <div class="col-md-8">
                              
                                <div class="row">
                                
                                    <div class="col-md-2" >
                                    
                                        <label class="col-md-2 control-label" for="property_type">begin</label>
                                    
                                    </div>
                                
                                    <div class="col-md-8">
                                    
                                        <input type="text" name="bdtv" th:field="${request.begindatetime}" id="bdtv" size="24" class="form-control input-md ItemLabel" maxLength="19" onkeydown="DateFormat(this, '1', event)" placeholder="begin time" onKeyUp="DateFormat(this, '1', event)" />
                                        
                                    </div>
                                    
                                    <div class="col-md-1 pl-0 pr-0">
                                    
                                        <a class="pull-left" href="javascript:NewCal('bdtv','yyyymmdd',true,24)">
                                                    
                                            <img src="../images/cal.gif" width="16" height="16" border="0" alt="Pick a date" />
                                        
                                        </a>
                                    
                                    </div>
                                
                                </div>
                                
                                <br/>
                                                
                                <div class="row">
                                
                                    <div class="col-md-2">
                                    
                                        <label class="col-md-2 control-label" for="property_type">end</label>
                                    
                                    </div>
                                
                                    <div class="col-md-8">
                                    
                                        <input name="edtv" id="edtv" th:field="${request.enddatetime}" type="text" size="24" class="form-control input-md ItemLabel" maxLength="19" onkeydown="DateFormat(this, '1', event)" placeholder="end time" onKeyUp="DateFormat(this, '1', event)" />
                                        
                                    </div>
                                    
                                    <div class="col-md-1 pl-0 pr-0">
                                        
                                            <a class="pull-left" href="javascript:NewCal('edtv','yyyymmdd',true,24)">
                                    
                                                <img src="../images/cal.gif" width="16" height="16" border="0" alt="Pick a date" />
                                        
                                            </a>
                                        
                                    </div> 
                                
                                </div>
                                                
                              
                              </div>
                         
                         </div>
                          
                    </div>
                    
                    <!-- Button -->
                    
                    <div class="col-md-12" style="margin-top: 5px;">
                    
                        <div class="row">
                        
                              <div class="col-md-12  text-center">
                            
                                <button id="submit" class="btn btn-primary">Search</button>
                            
                              </div>
                        
                        </div>
                        
                    </div>
                
                </fieldset>
            
            </form>
            
            <!-- ************************************************************* -->
            
            <div class="text-center" id="form_area" ></div>
            <br/>
            <br/>
            <br/>
        </div>
        
        <th:block layout:fragment="script">
        
            <script>
                
            //for format list
            
            $('.all').on('click', function(e){
            
                $this = this;  
              
                $.each($(this).parents('ul').find('input'), function(i, item){
                
                    $(item).prop('checked', $this.checked);
              
                });
            
            });
            
            $(function () {
                $('.button-checkbox').each(function () {

                    // Settings
                    var $widget = $(this),
                        $button = $widget.find('button'),
                        $checkbox = $widget.find('input:checkbox'),
                        color = $button.data('color'),
                        settings = {
                            on: {
                                icon: 'glyphicon glyphicon-check'
                            },
                            off: {
                                icon: 'glyphicon glyphicon-unchecked'
                            }
                        };

                    // Event Handlers
                    $button.on('click', function () {
                        $checkbox.prop('checked', !$checkbox.is(':checked'));
                        $checkbox.triggerHandler('change');
                        updateDisplay();
                    });
                    $checkbox.on('change', function () {
                        updateDisplay();
                    });

                    // Actions
                    function updateDisplay() {
                        var isChecked = $checkbox.is(':checked');

                        // Set the button's state
                        $button.data('state', (isChecked) ? "on" : "off");

                        // Set the button's icon
                        $button.find('.state-icon')
                            .removeClass()
                            .addClass('state-icon ' + settings[$button.data('state')].icon);

                        // Update the button's color
                        if (isChecked) {
                            $button
                                .removeClass('btn-default')
                                .addClass('btn-' + color + ' active');
                        }
                        else {
                            $button
                                .removeClass('btn-' + color + ' active')
                                .addClass('btn-default');
                        }
                    }

                    // Initialization
                    function init() {

                        updateDisplay();

                        // Inject the icon if applicable
                        if ($button.find('.state-icon').length == 0) {
                            $button.prepend('<i class="state-icon ' + settings[$button.data('state')].icon + '"></i>');
                        }
                    }
                    
                    init();
                
                });
                
            });
            
            //**********************************************//
            // Initialize Leaflet Map
          
            function initializeMap(){
                
                var mymap = L.map('mapid').setView([36, -78], 13);
                
                var osmUrl='http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
                
                var osmAttrib='Map data ï¿½ <a href="http://openstreetmap.org">OpenStreetMap</a> contributors';
                
                var osm = new L.TileLayer(osmUrl, {attribution: osmAttrib});        
                
                // start the map in South-East England
                //mymap.setView(new L.LatLng(-78, 36),9);
                
                var southWest = new L.LatLng(90, 180),
                
                northEast = new L.LatLng(-90, -180),
                
                bounds = new L.LatLngBounds(southWest, northEast);
        
                mymap.fitBounds(bounds);
        
                mymap.addLayer(osm);
                
                mymap.on('moveend', function(e) {
                    
                       var bounds = mymap.getBounds();
                    
                       var sw = bounds.getSouthWest().wrap();
                       
                       var south = sw.lat;
                       
                       var west = sw.lng;
                       
                       var ne = bounds.getNorthEast().wrap();
                       
                       var north = ne.lat;
                       
                       var east = ne.lng;
                       
                       $("#south").val(south);
                       
                       $("#west").val(west);
                       
                       $("#north").val(north);
                       
                       $("#east").val(east);
                       
                       console.log("bounds changed:" + south + " " + north + " " + west + " " + east);
                       
                });
                
            }
            
            initializeMap();
            
            $("#moreorless").click(function(){
                
                if($("#formatlist").is(":visible")){
                    
                    $("#formatlist").hide();
                    
                }else{
                    
                    $("#formatlist").show();
                    
                }
                
            });
            
            $("#formatlist").hide();
            
            //set CSW to null
            if($("#isvirtual").val()=="0")
                $('#csw').prop('disabled', false);
            else    
                $("#csw").val($("#csw option:eq(0)").val());
            
            //add listener to virtual box
            
            $("#isvirtual").on('change', function(){
                
                if(this.value == "1"){
                    console.log("virtual");
                    $('#csw').prop('disabled', 'disabled');
                    $("#csw").val($("#csw option:eq(0)").val());
                }else if(this.value=="0"){
                    console.log("real");
                    $('#csw').prop('disabled', false);
                    $("#csw").val($("#csw option:eq(1)").val());
                }
                
            });
            
            $("#distime").change(function(){
                
                if($(this).is(':checked')) {
                    
                    $(this).val("true");
                    
                    $("#bdtv").prop('disabled', true);        
                    
                    $("#edtv").prop('disabled', true);        
                    
                } else {
                
                    $(this).val("false");
                    
                    $("#bdtv").prop('disabled', false);        
                    
                    $("#edtv").prop('disabled', false);        
                
                }

            });
            
            //**********************************************//
            
            </script>
        
        </th:block>
        
      </body>
  
</html>
